name: "Publish MCART"
on:
  release:
    types:
      - created
jobs:
  test-publish:
    runs-on: windows-latest
    env:
      Solution_Name: src/MCART.sln
      Configuration: Release
    steps:
    - name: Checkout
      uses: actions/checkout@v3
    - name: Install .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: | 
            6.0.x
            7.0.x
    - name: Create NuGet Packages
      run: dotnet pack $env:Solution_Name --configuration=$env:Configuration -p:Version=$env:GIT_REF_NAME -p:RepositoryBranch=${{ github.ref }} -p:ContinuousIntegrationBuild=true

    - name: Push packages to GitHub
      run: dotnet nuget push "Build/**/*.nupkg" -k $env:GhToken --skip-duplicate --source "https://nuget.pkg.github.com/TheXDS/"
      env:
        GhToken: ${{ secrets.GITHUB_TOKEN }}
    - name: Push packages to NuGet
      run: dotnet nuget push "Build/**/*.nupkg" -k $env:NgToken --skip-duplicate --source "https://api.nuget.org/v3/index.json"
      env:
        NgToken: ${{ secrets.NUGET_TOKEN }}
